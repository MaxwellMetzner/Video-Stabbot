<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; style-src 'self' 'unsafe-inline'; img-src 'self' data:">
    <title>Video Stabbot</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="app">
        <!-- Header -->
        <header>
            <div class="logo">
                <span class="logo-icon">&#127916;</span>
                <h1>Video Stabbot</h1>
            </div>
            <div id="encoder-badge" class="badge hidden">
                <span class="badge-dot"></span>
                <span id="encoder-name"></span>
            </div>
        </header>

        <!-- Toast -->
        <div id="toast" class="toast">
            <span id="toast-message"></span>
        </div>

        <main>
            <!-- Loading View -->
            <section id="view-loading" class="view active">
                <div class="view-content centered">
                    <div class="spinner"></div>
                    <p class="muted">Detecting system capabilities&hellip;</p>
                </div>
            </section>

            <!-- Error View -->
            <section id="view-error" class="view">
                <div class="view-content centered">
                    <div class="icon-circle icon-error">!</div>
                    <h2>Setup Issue</h2>
                    <p id="error-message" class="muted error-text"></p>
                </div>
            </section>

            <!-- File Selection View -->
            <section id="view-select" class="view">
                <div class="view-content centered">
                    <div id="drop-zone" tabindex="0" role="button" aria-label="Drop video file here or click to browse">
                        <div class="drop-icon">
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="2" y="3" width="20" height="18" rx="2"/>
                                <path d="M8 3v18"/>
                                <path d="M16 3v18"/>
                                <path d="M2 9h20"/>
                                <path d="M2 15h20"/>
                            </svg>
                        </div>
                        <p class="drop-text">Drop video file here</p>
                        <span class="drop-hint">or click to browse</span>
                        <span class="drop-formats">MP4, AVI, MOV, MKV, WMV, WEBM</span>
                    </div>
                </div>
            </section>

            <!-- Quality Selection View -->
            <section id="view-quality" class="view">
                <div class="view-content">
                    <div class="file-info">
                        <div class="file-name" id="file-name"></div>
                        <div class="file-meta" id="file-meta"></div>
                    </div>

                    <div class="quality-grid">
                        <button class="quality-card" id="btn-quick">
                            <span class="card-icon">&#9889;</span>
                            <h3>Quick</h3>
                            <p class="card-desc">Fast processing, smooth results</p>
                            <ul class="card-details">
                                <li>Rapid motion analysis</li>
                                <li>Bilinear interpolation</li>
                                <li>Balanced encoding</li>
                            </ul>
                        </button>

                        <button class="quality-card card-hq" id="btn-hq">
                            <span class="card-icon">&#10024;</span>
                            <h3>High Quality</h3>
                            <p class="card-desc">Best stabilization, detailed analysis</p>
                            <ul class="card-details">
                                <li>Deep motion analysis</li>
                                <li>Bicubic interpolation</li>
                                <li>Maximum quality encoding</li>
                            </ul>
                        </button>

                        <button class="quality-card card-custom" id="btn-custom">
                            <span class="card-icon">&#9881;</span>
                            <h3>Custom</h3>
                            <p class="card-desc">Full control over every parameter</p>
                            <ul class="card-details">
                                <li>Border &amp; crop modes</li>
                                <li>Smoothing &amp; zoom</li>
                                <li>All encoding options</li>
                            </ul>
                        </button>
                    </div>

                    <div class="section-divider"><span>Advanced Modes</span></div>

                    <div class="advanced-grid">
                        <button class="quality-card card-subject" id="btn-subject">
                            <span class="card-icon">&#127919;</span>
                            <h3>Subject Lock</h3>
                            <p class="card-desc">Track a face or point and keep it centered</p>
                        </button>

                        <button class="quality-card card-panorama" id="btn-panorama">
                            <span class="card-icon">&#127748;</span>
                            <h3>Panorama</h3>
                            <p class="card-desc">Mosaic accumulation on an expanded canvas</p>
                        </button>
                    </div>

                    <button id="btn-back" class="btn-text">&larr; Choose a different file</button>
                </div>
            </section>

            <!-- Subject Lock Settings View -->
            <section id="view-subject" class="view">
                <div class="view-content custom-settings-content">
                    <h2 class="custom-title">Subject Lock Settings</h2>

                    <div class="settings-scroll">
                        <div class="setting-group">
                            <div class="setting-header">
                                <label class="setting-label">Tracking Mode</label>
                            </div>
                            <span class="setting-hint">How to find and track the subject across frames.</span>
                            <div class="radio-group" id="opt-track-mode">
                                <label class="radio-option active" data-value="face">
                                    <span class="radio-dot"></span>
                                    <span class="radio-text">
                                        <strong>Face Detection</strong>
                                        <span>Automatically detect and follow the largest face</span>
                                    </span>
                                </label>
                                <label class="radio-option" data-value="point">
                                    <span class="radio-dot"></span>
                                    <span class="radio-text">
                                        <strong>Center Point</strong>
                                        <span>Track the center of the frame (reframe only)</span>
                                    </span>
                                </label>
                            </div>
                        </div>

                        <div class="setting-group">
                            <div class="setting-header">
                                <label class="setting-label">Smoothing</label>
                                <span class="setting-value" id="val-subject-smooth">30</span>
                            </div>
                            <span class="setting-hint">How smoothly the crop window follows the subject. Higher = smoother, more latency.</span>
                            <input type="range" class="slider" id="opt-subject-smooth" min="1" max="120" value="30">
                            <div class="slider-labels"><span>Responsive</span><span>Very smooth</span></div>
                        </div>

                        <div class="setting-group">
                            <div class="setting-header">
                                <label class="setting-label">Crop Scale</label>
                                <span class="setting-value" id="val-subject-scale">70%</span>
                            </div>
                            <span class="setting-hint">How much of the original frame to keep. Smaller = tighter crop around subject.</span>
                            <input type="range" class="slider" id="opt-subject-scale" min="30" max="100" value="70">
                            <div class="slider-labels"><span>Tight (30%)</span><span>Full (100%)</span></div>
                        </div>

                        <div class="setting-group">
                            <div class="setting-header">
                                <label class="setting-label">Output Resolution</label>
                            </div>
                            <span class="setting-hint">Resolution of the output video.</span>
                            <select class="select-input" id="opt-subject-resolution">
                                <option value="source" selected>Match source</option>
                                <option value="1080p">1920 &times; 1080</option>
                                <option value="720p">1280 &times; 720</option>
                                <option value="480p">854 &times; 480</option>
                            </select>
                        </div>
                    </div>

                    <div class="custom-actions">
                        <button id="btn-subject-back" class="btn-text">&larr; Back to modes</button>
                        <button id="btn-subject-start" class="btn-primary">Start Tracking</button>
                    </div>
                </div>
            </section>

            <!-- Panorama Settings View -->
            <section id="view-panorama" class="view">
                <div class="view-content custom-settings-content">
                    <h2 class="custom-title">Panorama Mosaic Settings</h2>

                    <div class="settings-scroll">
                        <div class="setting-group">
                            <div class="setting-header">
                                <label class="setting-label">Output Type</label>
                            </div>
                            <span class="setting-hint">What to produce from the video.</span>
                            <div class="radio-group" id="opt-pano-output">
                                <label class="radio-option active" data-value="video">
                                    <span class="radio-dot"></span>
                                    <span class="radio-text">
                                        <strong>Stabilized Video</strong>
                                        <span>Expanded canvas video &mdash; new regions persist instead of being cropped</span>
                                    </span>
                                </label>
                                <label class="radio-option" data-value="image">
                                    <span class="radio-dot"></span>
                                    <span class="radio-text">
                                        <strong>Panorama Image</strong>
                                        <span>Single composite image stitched from all frames</span>
                                    </span>
                                </label>
                            </div>
                        </div>

                        <div class="setting-group">
                            <div class="setting-header">
                                <label class="setting-label">Feature Detector</label>
                            </div>
                            <span class="setting-hint">Algorithm for matching keypoints between frames.</span>
                            <select class="select-input" id="opt-pano-detector">
                                <option value="orb" selected>ORB &mdash; Fast, good for most videos</option>
                                <option value="sift">SIFT &mdash; More robust, slower</option>
                            </select>
                        </div>

                        <div class="setting-group">
                            <div class="setting-header">
                                <label class="setting-label">Smoothing</label>
                                <span class="setting-value" id="val-pano-smooth">50</span>
                            </div>
                            <span class="setting-hint">Camera path smoothing for the expanded canvas stabilization.</span>
                            <input type="range" class="slider" id="opt-pano-smooth" min="5" max="200" value="50">
                            <div class="slider-labels"><span>Minimal</span><span>Maximum</span></div>
                        </div>

                        <div class="setting-group">
                            <div class="setting-header">
                                <label class="setting-label">Blend Mode</label>
                            </div>
                            <span class="setting-hint">How overlapping regions are merged on the canvas.</span>
                            <select class="select-input" id="opt-pano-blend">
                                <option value="overlay" selected>Overlay &mdash; Latest frame wins</option>
                                <option value="average">Average &mdash; Blend overlapping pixels</option>
                                <option value="max">Maximum &mdash; Keep brightest pixels</option>
                            </select>
                        </div>
                    </div>

                    <div class="custom-actions">
                        <button id="btn-pano-back" class="btn-text">&larr; Back to modes</button>
                        <button id="btn-pano-start" class="btn-primary">Build Panorama</button>
                    </div>
                </div>
            </section>

            <!-- Custom Settings View -->
            <section id="view-custom" class="view">
                <div class="view-content custom-settings-content">
                    <h2 class="custom-title">Custom Settings</h2>

                    <div class="settings-scroll">
                        <!-- Border Mode -->
                        <div class="setting-group">
                            <div class="setting-header">
                                <label class="setting-label">Border Mode</label>
                                <span class="setting-hint">What happens when stabilization reveals edges</span>
                            </div>
                            <div class="radio-group" id="opt-border">
                                <label class="radio-option active" data-value="black">
                                    <span class="radio-dot"></span>
                                    <span class="radio-text">
                                        <strong>Black Fill</strong>
                                        <span>Gaps filled with black &mdash; clean, cinematic look</span>
                                    </span>
                                </label>
                                <label class="radio-option" data-value="keep">
                                    <span class="radio-dot"></span>
                                    <span class="radio-text">
                                        <strong>Keep Frame</strong>
                                        <span>Original pixels persist at borders</span>
                                    </span>
                                </label>
                            </div>
                        </div>

                        <!-- Smoothing -->
                        <div class="setting-group">
                            <div class="setting-header">
                                <label class="setting-label">Smoothing</label>
                                <span class="setting-value" id="val-smoothing">30</span>
                            </div>
                            <span class="setting-hint">Higher = smoother camera path, more crop. Lower = keeps more original motion.</span>
                            <input type="range" class="slider" id="opt-smoothing" min="1" max="200" value="30">
                            <div class="slider-labels"><span>Minimal</span><span>Maximum</span></div>
                        </div>

                        <!-- Shakiness -->
                        <div class="setting-group">
                            <div class="setting-header">
                                <label class="setting-label">Shakiness Detection</label>
                                <span class="setting-value" id="val-shakiness">8</span>
                            </div>
                            <span class="setting-hint">How aggressively to detect camera shake in the source.</span>
                            <input type="range" class="slider" id="opt-shakiness" min="1" max="10" value="8">
                            <div class="slider-labels"><span>Subtle</span><span>Aggressive</span></div>
                        </div>

                        <!-- Accuracy -->
                        <div class="setting-group">
                            <div class="setting-header">
                                <label class="setting-label">Detection Accuracy</label>
                                <span class="setting-value" id="val-accuracy">15</span>
                            </div>
                            <span class="setting-hint">Analysis precision. Higher is slower but more accurate.</span>
                            <input type="range" class="slider" id="opt-accuracy" min="1" max="15" value="15">
                            <div class="slider-labels"><span>Fast</span><span>Precise</span></div>
                        </div>

                        <!-- Auto Zoom -->
                        <div class="setting-group">
                            <div class="setting-header">
                                <label class="setting-label">Auto Zoom</label>
                                <span class="setting-hint">Automatically zoom to minimize black borders</span>
                            </div>
                            <div class="radio-group" id="opt-optzoom">
                                <label class="radio-option" data-value="0">
                                    <span class="radio-dot"></span>
                                    <span class="radio-text">
                                        <strong>Disabled</strong>
                                        <span>No automatic zoom, use manual value only</span>
                                    </span>
                                </label>
                                <label class="radio-option active" data-value="1">
                                    <span class="radio-dot"></span>
                                    <span class="radio-text">
                                        <strong>Static</strong>
                                        <span>Optimal fixed zoom for the whole video</span>
                                    </span>
                                </label>
                                <label class="radio-option" data-value="2">
                                    <span class="radio-dot"></span>
                                    <span class="radio-text">
                                        <strong>Adaptive</strong>
                                        <span>Per-frame dynamic zoom (may cause pulsing)</span>
                                    </span>
                                </label>
                            </div>
                        </div>

                        <!-- Zoom -->
                        <div class="setting-group">
                            <div class="setting-header">
                                <label class="setting-label">Manual Zoom</label>
                                <span class="setting-value" id="val-zoom">0%</span>
                            </div>
                            <span class="setting-hint">Additional zoom percentage. Positive zooms in, negative zooms out.</span>
                            <input type="range" class="slider" id="opt-zoom" min="-50" max="50" value="0">
                            <div class="slider-labels"><span>-50%</span><span>0%</span><span>+50%</span></div>
                        </div>

                        <!-- Interpolation -->
                        <div class="setting-group">
                            <div class="setting-header">
                                <label class="setting-label">Interpolation</label>
                            </div>
                            <span class="setting-hint">Pixel interpolation quality when transforming frames.</span>
                            <select class="select-input" id="opt-interpol">
                                <option value="bilinear">Bilinear &mdash; Good balance</option>
                                <option value="bicubic" selected>Bicubic &mdash; Highest quality</option>
                                <option value="linear">Linear &mdash; Fastest</option>
                            </select>
                        </div>

                        <!-- Tripod Mode -->
                        <div class="setting-group">
                            <div class="setting-header">
                                <label class="setting-label">Tripod Mode</label>
                            </div>
                            <span class="setting-hint">Lock stabilization to the first frame. Best for fixed-camera shots with slight bumps.</span>
                            <div class="toggle-row">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="opt-tripod">
                                    <span class="toggle-track"><span class="toggle-thumb"></span></span>
                                </label>
                                <span class="toggle-label" id="lbl-tripod">Off</span>
                            </div>
                        </div>

                        <!-- Max Shift -->
                        <div class="setting-group">
                            <div class="setting-header">
                                <label class="setting-label">Max Shift</label>
                                <span class="setting-value" id="val-maxshift">unlimited</span>
                            </div>
                            <span class="setting-hint">Maximum shift in pixels per frame. Prevents extreme corrections. 0 = unlimited.</span>
                            <input type="range" class="slider" id="opt-maxshift" min="0" max="500" value="0">
                            <div class="slider-labels"><span>Unlimited</span><span>500 px</span></div>
                        </div>

                        <!-- Max Angle -->
                        <div class="setting-group">
                            <div class="setting-header">
                                <label class="setting-label">Max Rotation</label>
                                <span class="setting-value" id="val-maxangle">unlimited</span>
                            </div>
                            <span class="setting-hint">Maximum rotation correction in degrees. Prevents warping artifacts. 0 = unlimited.</span>
                            <input type="range" class="slider" id="opt-maxangle" min="0" max="45" value="0" step="1">
                            <div class="slider-labels"><span>Unlimited</span><span>45&deg;</span></div>
                        </div>

                        <!-- Step Size -->
                        <div class="setting-group">
                            <div class="setting-header">
                                <label class="setting-label">Step Size</label>
                                <span class="setting-value" id="val-stepsize">6</span>
                            </div>
                            <span class="setting-hint">Region size in pixels for motion detection. Smaller = more detail, slower.</span>
                            <input type="range" class="slider" id="opt-stepsize" min="1" max="32" value="6">
                            <div class="slider-labels"><span>1 px</span><span>32 px</span></div>
                        </div>

                        <!-- Min Contrast -->
                        <div class="setting-group">
                            <div class="setting-header">
                                <label class="setting-label">Min Contrast</label>
                                <span class="setting-value" id="val-mincontrast">0.25</span>
                            </div>
                            <span class="setting-hint">Minimum contrast for motion detection. Below this, regions are ignored. Lower detects more.</span>
                            <input type="range" class="slider" id="opt-mincontrast" min="0" max="1" value="0.25" step="0.01">
                            <div class="slider-labels"><span>0</span><span>1.0</span></div>
                        </div>

                        <!-- Encoding Quality -->
                        <div class="setting-group">
                            <div class="setting-header">
                                <label class="setting-label">Encoding Quality</label>
                            </div>
                            <span class="setting-hint">Trade off between file size and visual quality.</span>
                            <select class="select-input" id="opt-encoding">
                                <option value="high">High &mdash; Larger file, best quality</option>
                                <option value="balanced" selected>Balanced &mdash; Recommended</option>
                                <option value="compressed">Compressed &mdash; Smallest file</option>
                            </select>
                        </div>
                    </div>

                    <div class="custom-actions">
                        <button id="btn-custom-back" class="btn-text">&larr; Back to presets</button>
                        <button id="btn-custom-start" class="btn-primary">Stabilize Video</button>
                    </div>
                </div>
            </section>

            <!-- Processing View -->
            <section id="view-processing" class="view">
                <div class="view-content centered" id="processing-content">
                    <div class="phase-label" id="phase-label">Analyzing motion&hellip;</div>
                    <div class="progress-container">
                        <div class="progress-bar" id="progress-bar"></div>
                    </div>
                    <div class="progress-stats">
                        <span id="progress-percent">0%</span>
                        <span id="progress-elapsed">0:00</span>
                    </div>
                    <button id="btn-cancel" class="btn-secondary">Cancel</button>
                </div>
                <div class="view-content centered hidden" id="processing-error">
                    <div class="icon-circle icon-error">!</div>
                    <h2>Processing Failed</h2>
                    <pre id="error-detail" class="error-log"></pre>
                    <div class="error-actions">
                        <button id="btn-copy-error" class="btn-secondary btn-small">Copy Error</button>
                        <button id="btn-error-back" class="btn-secondary">Go Back</button>
                    </div>
                </div>
            </section>

            <!-- Complete View -->
            <section id="view-complete" class="view">
                <div class="view-content centered">
                    <div class="icon-circle icon-success">&#10003;</div>
                    <h2>Stabilization Complete</h2>
                    <div class="results-grid">
                        <div class="result-row">
                            <span class="result-label">Detection</span>
                            <span class="result-value" id="stat-detect"></span>
                        </div>
                        <div class="result-row">
                            <span class="result-label">Stabilization</span>
                            <span class="result-value" id="stat-transform"></span>
                        </div>
                        <div class="result-row">
                            <span class="result-label">Total time</span>
                            <span class="result-value" id="stat-total"></span>
                        </div>
                        <div class="result-divider"></div>
                        <div class="result-row">
                            <span class="result-label">Original</span>
                            <span class="result-value" id="stat-original-size"></span>
                        </div>
                        <div class="result-row">
                            <span class="result-label">Stabilized</span>
                            <span class="result-value" id="stat-output-size"></span>
                        </div>
                    </div>
                    <div class="action-buttons">
                        <button id="btn-show-folder" class="btn-secondary">Show in Folder</button>
                        <button id="btn-another" class="btn-primary">Process Another</button>
                    </div>
                </div>
            </section>
        </main>
    </div>
    <script src="renderer.js"></script>
</body>
</html>
